<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››é‚Šå½¢å‹•ç•«å­¸ç¿’å™¨</title>
    <style>
        /* é‡ç½®æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* é¡µé¢åŸºç¡€æ ·å¼ */
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .shape-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: white;
            color: #333;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .shape-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .shape-btn.active {
            background: #ffd700;
            color: #333;
        }

        /* å…³ç³»å›¾æŒ‰é’®æ ·å¼ */
        .relationship-diagram-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .relationship-diagram-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .relationship-diagram-btn.active {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        /* ä¸»è¦åŠ¨ç”»å®¹å™¨ */
        .animation-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            max-width: 900px;
            width: 100%;
        }

        /* å½¢çŠ¶æ˜¾ç¤ºåŒºåŸŸ */
        .shape-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            min-height: 300px;
        }

        .shape-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .shape {
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .shape.morphing {
            animation: morph 1.5s ease-in-out;
        }

        .shape.transforming {
            transition: all 2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes morph {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.2); }
        }

        .shape.animating {
            animation: pulse 0.5s ease-in-out;
        }

        /* åŠ¨ç”»æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .animation-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        /* åŠ¨ç”»æ§åˆ¶æŒ‰é’® */
        .animate-transformation-btn {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .animate-transformation-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .animate-transformation-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ç‰¹æ€§å¯¹æ¯”æŒ‰é’® */
        .comparison-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .comparison-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* è¿›åº¦æ¡ */
        .transformation-progress {
            width: 150px;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            width: 0%;
            transition: width 0.1s ease;
            border-radius: 2px;
        }

        /* å±æ€§é¢æ¿ */
        .properties-panel {
            flex: 1;
            margin-left: 40px;
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
        }

        .properties-panel h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .property {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .property.highlight {
            background: #e8f5e8;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .property:hover {
            background: #f0f8ff;
            transform: scale(1.01);
        }

        .property-icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 50%;
        }

        .parallel { background: #4CAF50; }
        .equal { background: #2196F3; }
        .right-angle { background: #FF9800; }
        .diagonal { background: #9C27B0; }

        /* SVG è§†è§‰å…ƒç´ æ ·å¼ */
        .visual-element {
            opacity: 0.3;
            transition: all 0.5s ease;
        }

        .visual-element.highlight {
            opacity: 1;
            filter: drop-shadow(0 0 3px currentColor);
        }

        .parallel-mark {
            stroke: #4CAF50;
            stroke-width: 2;
            fill: none;
        }

        .equal-mark {
            stroke: #2196F3;
            stroke-width: 2;
            fill: none;
        }

        .angle-mark {
            stroke: #FF9800;
            stroke-width: 2;
            fill: none;
        }

        .general-angle-mark {
            stroke: #FF9800;
            stroke-width: 2;
            fill: none;
        }

        .diagonal-line {
            stroke: #9C27B0;
            stroke-width: 1.5;
            stroke-dasharray: 3,3;
            fill: none;
        }

        /* å…³ç³»ç½‘ç»œåŒºåŸŸ */
        .relationship-network {
            margin-top: 30px;
            text-align: center;
        }

        .relationship-info {
            background: transparent;
            border: none;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .relationship-info.hidden {
            opacity: 0.5;
            background: transparent;
            border-color: transparent;
        }

        .relationship-info h4 {
            margin: 0;
            color: #333;
            font-size: 14px;
            line-height: 1.4;
        }

        .relationship-info.transformation {
            background: #e8f5e8;
            border: 2px solid #4CAF50;
        }

        .relationship-info.transformation h4 {
            color: #2e7d32;
        }

        .relationship-info.hidden h4 {
            color: #6c757d;
        }

        .network-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            height: 120px;
            margin: 0 auto;
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            box-sizing: border-box;
        }

        /* å½¢çŠ¶èŠ‚ç‚¹æ ·å¼ */
        .shape-node {
            padding: 12px 18px;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 2;
            border: 2px solid #333;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            position: relative;
        }

        .shape-node.trapezoid { 
            background: #ddbdff; 
            color: #333; 
            width: 90px;
            height: 55px;
            clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);
            border: none;
            font-size: 13px;
        }

        .shape-node.parallelogram { 
            background: #ffecb3; 
            color: #333; 
            width: 95px;
            height: 55px;
            transform: skewX(-20deg);
        }

        .shape-node.parallelogram span {
            transform: skewX(20deg);
            display: block;
            font-size: 12px;
        }

        .shape-node.rectangle { 
            background: #c8e6c9; 
            color: #333; 
            width: 85px;
            height: 55px;
            border-radius: 0;
        }

        .shape-node.rhombus { 
            background: #f8bbd9; 
            color: #333; 
            width: 60px;
            height: 60px;
            transform: rotate(45deg);
            border-radius: 0;
        }

        .shape-node.rhombus span {
            transform: rotate(-45deg);
            display: block;
            font-size: 13px;
        }

        .shape-node.square { 
            background: #ffd54f; 
            color: #333; 
            width: 60px;
            height: 60px;
            border-radius: 0;
        }

        .shape-node:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            z-index: 3;
            transform: scale(1.1);
        }

        .shape-node.parallelogram:hover {
            transform: skewX(-20deg) scale(1.1);
        }

        .shape-node.rhombus:hover {
            transform: rotate(45deg) scale(1.1);
        }

        .shape-node.active {
            color: white !important;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
            transform: scale(1.1);
            z-index: 4;
        }

        .shape-node.active.parallelogram {
            transform: skewX(-20deg) scale(1.1);
        }

        .shape-node.active.rhombus {
            transform: rotate(45deg) scale(1.1);
        }

        /* ä¸»å½¢çŠ¶åŠ¨ç”»æ ·å¼ */
        #main-shape {
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #main-shape.morphing {
            animation: morph 1.5s ease-in-out;
        }

        #main-shape.transforming {
            transition: all 2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #main-shape.animating {
            animation: pulse 0.5s ease-in-out;
        }

        /* ç‰¹æ€§å¯¹æ¯”æ ·å¼ */
        .property-comparison {
            margin: 15px 0;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f5e8 100%);
            border-radius: 12px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: slideInCategory 0.6s ease forwards;
            overflow: hidden;
        }

        @keyframes slideInCategory {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å…³ç³»å›¾æ ·å¼ */
        #relationship-svg {
            max-width: 100%;
            height: auto;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f5e8 100%);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #relationship-svg rect[data-shape] {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #relationship-svg rect[data-shape]:hover {
            stroke-width: 4;
            filter: brightness(1.1);
            transform: scale(1.02);
            transform-origin: center;
        }

        #relationship-svg text {
            cursor: default;
            user-select: none;
        }

        #relationship-svg text[style*="cursor: pointer"] {
            cursor: pointer;
        }

        #relationship-svg text[style*="cursor: pointer"]:hover {
            fill: #333 !important;
            font-weight: bold;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .shape-display {
                flex-direction: column;
            }
            
            .properties-panel {
                margin-left: 0;
                margin-top: 20px;
            }
            
            .network-container {
                flex-wrap: wrap;
                height: auto;
                gap: 15px;
                justify-content: center;
                padding: 15px;
            }
            
            .shape-node {
                margin: 5px;
            }
            
            .shape-node.parallelogram span,
            .shape-node.rhombus span {
                font-size: 11px;
            }

            .animation-controls {
                flex-direction: column;
                align-items: center;
            }

            /* å…³ç³»å›¾å“åº”å¼è°ƒæ•´ */
            #relationship-svg {
                width: 100%;
                height: 350px;
            }
            
            #relationship-svg text {
                font-size: 8px !important;
            }
            
            #relationship-svg .explanation-text {
                font-size: 6px !important;
            }
            
            /* éšè—ç§»åŠ¨ç«¯ä¸Šè¿‡å°çš„æ–‡æœ¬ */
            #relationship-svg text[font-size="10"],
            #relationship-svg text[font-size="11"] {
                display: none;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .relationship-diagram-btn {
                order: -1; /* åœ¨ç§»åŠ¨ç«¯å°†å…³ç³»å›¾æŒ‰é’®æ”¾åˆ°æœ€å‰é¢ */
                font-size: 14px;
                padding: 10px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”· å››é‚Šå½¢æ¢ç´¢æ¨‚åœ’ ğŸ”·</h1>
        <p>ç™¼ç¾å„ç¨®å››é‚Šå½¢çš„å¥‡å¦™ç‰¹æ€§å’Œå®ƒå€‘ä¹‹é–“çš„é—œä¿‚ï¼</p>
    </div>

    <div class="controls">
        <button class="shape-btn active" data-shape="square">æ­£æ–¹å½¢</button>
        <button class="shape-btn" data-shape="rectangle">é•·æ–¹å½¢</button>
        <button class="shape-btn" data-shape="rhombus">è±å½¢</button>
        <button class="shape-btn" data-shape="parallelogram">å¹³è¡Œå››é‚Šå½¢</button>
        <button class="shape-btn" data-shape="trapezoid">æ¢¯å½¢</button>
        <button class="relationship-diagram-btn" id="relationship-diagram-btn">åœ–å½¢é—œä¿‚åœ–</button>
    </div>

    <div class="animation-container">
        <div class="shape-display">
            <div class="shape-area">
                <!-- å½¢çŠ¶æ˜¾ç¤ºSVG -->
                <svg id="shape-svg" width="250" height="250" viewBox="0 0 250 250" style="display: block;">
                    <polygon id="main-shape" points="" fill="#4CAF50" stroke="#333" stroke-width="3"/>
                    
                    <!-- å¹³è¡Œç·šæ¨™è¨˜ -->
                    <g id="parallel-marks" class="visual-element">
                        <g class="parallel-mark" data-type="parallel">
                            <line id="parallel1a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="parallel1b" x1="0" y1="0" x2="0" y2="0" />
                            <line id="parallel2a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="parallel2b" x1="0" y1="0" x2="0" y2="0" />
                        </g>
                    </g>
                    
                    <!-- ç›´è§’æ¨™è¨˜ -->
                    <g id="angle-marks" class="visual-element">
                        <g class="angle-mark" data-type="right-angle">
                            <rect id="angle1" x="0" y="0" width="15" height="15" />
                            <rect id="angle2" x="0" y="0" width="15" height="15" />
                            <rect id="angle3" x="0" y="0" width="15" height="15" />
                            <rect id="angle4" x="0" y="0" width="15" height="15" />
                        </g>
                    </g>
                    
                    <!-- éç›´è§’æ¨™è¨˜ï¼ˆè±å½¢ã€å¹³è¡Œå››é‚Šå½¢ç”¨ï¼‰ -->
                    <g id="angle-marks-general" class="visual-element">
                        <g class="general-angle-mark" data-type="general-angle">
                            <circle id="angle-dot1" cx="0" cy="0" r="0" fill="#FF9800" />
                            <circle id="angle-dot2" cx="0" cy="0" r="0" fill="#FF9800" />
                            <circle id="angle-dot3" cx="0" cy="0" r="0" fill="#FF9800" />
                            <circle id="angle-dot4" cx="0" cy="0" r="0" fill="#FF9800" />
                        </g>
                    </g>
                    
                    <!-- ç›¸ç­‰é‚Šæ¨™è¨˜ -->
                    <g id="equal-marks" class="visual-element">
                        <g class="equal-mark" data-type="equal">
                            <line id="equal1a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="equal1b" x1="0" y1="0" x2="0" y2="0" />
                            <line id="equal2a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="equal2b" x1="0" y1="0" x2="0" y2="0" />
                            <line id="equal3a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="equal3b" x1="0" y1="0" x2="0" y2="0" />
                            <line id="equal4a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="equal4b" x1="0" y1="0" x2="0" y2="0" />
                        </g>
                    </g>
                    
                    <!-- æ¢¯å½¢å…©è…°æ¨™è¨˜ -->
                    <g id="sides-marks" class="visual-element">
                        <g class="equal-mark" data-type="equal-sides">
                            <line id="side1a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="side2a" x1="0" y1="0" x2="0" y2="0" />
                            <line id="side2b" x1="0" y1="0" x2="0" y2="0" />
                        </g>
                    </g>
                    
                    <!-- å°è§’ç·š -->
                    <g id="diagonal-marks" class="visual-element">
                        <g class="diagonal-line" data-type="diagonal">
                            <line id="diagonal1" x1="0" y1="0" x2="0" y2="0" />
                            <line id="diagonal2" x1="0" y1="0" x2="0" y2="0" />
                        </g>
                    </g>
                </svg>

                <!-- å…³ç³»å›¾SVG -->
                <svg id="relationship-svg" width="700" height="450" viewBox="0 0 700 450" style="display: none;">
                    <!-- å®šä¹‰æ¸å˜ -->
                    <defs>
                        <linearGradient id="generalQuadGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e3f2fd;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#bbdefb;stop-opacity:0.7" />
                        </linearGradient>
                        <linearGradient id="irregularQuadGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fff3e0;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#ffcc80;stop-opacity:0.7" />
                        </linearGradient>
                        <linearGradient id="trapezoidGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f3e5f5;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#ce93d8;stop-opacity:0.7" />
                        </linearGradient>
                        <linearGradient id="generalTrapezoidGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f3e5f5;stop-opacity:0.6" />
                            <stop offset="100%" style="stop-color:#e1bee7;stop-opacity:0.4" />
                        </linearGradient>
                        <linearGradient id="parallelogramGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fff8e1;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#ffecb3;stop-opacity:0.7" />
                        </linearGradient>
                        <linearGradient id="generalParallelogramGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fff8e1;stop-opacity:0.6" />
                            <stop offset="100%" style="stop-color:#fff3c4;stop-opacity:0.4" />
                        </linearGradient>
                        <linearGradient id="rectangleGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#e8f5e8;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#c8e6c9;stop-opacity:0.7" />
                        </linearGradient>
                        <linearGradient id="rhombusGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fce4ec;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#f8bbd9;stop-opacity:0.7" />
                        </linearGradient>
                        <linearGradient id="squareGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#fff9c4;stop-opacity:0.95" />
                            <stop offset="100%" style="stop-color:#ffd54f;stop-opacity:0.8" />
                        </linearGradient>
                    </defs>
                    
                    <!-- ä¸€èˆ¬å››è¾¹å½¢ï¼ˆæœ€å¤–å±‚å¤§é•¿æ–¹å½¢ï¼‰ -->
                    <rect x="50" y="50" width="600" height="320" fill="url(#generalQuadGrad)" stroke="#1976d2" stroke-width="3" rx="8"/>
                    <text x="350" y="35" text-anchor="middle" font-size="18" font-weight="bold" fill="#1976d2">ä¸€èˆ¬å››é‚Šå½¢</text>
                    
                    <!-- åˆ†å‰²çº¿ï¼šåˆ†ç¦»ä¸è§„åˆ™å››è¾¹å½¢å’Œæ¢¯å½¢ -->
                    <line x1="250" y1="50" x2="250" y2="370" stroke="#1976d2" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- ä¸è§„åˆ™å››è¾¹å½¢åŒºåŸŸ -->
                    <rect x="60" y="60" width="180" height="300" fill="url(#irregularQuadGrad)" stroke="#f57c00" stroke-width="2" rx="5"/>
                    <text x="150" y="210" text-anchor="middle" font-size="14" font-weight="bold" fill="#f57c00">ä¸è¦å‰‡å››é‚Šå½¢</text>
                    
                    <!-- æ¢¯å½¢åŒºåŸŸ -->
                    <rect x="260" y="60" width="380" height="300" fill="url(#trapezoidGrad)" stroke="#7b1fa2" stroke-width="2" rx="5" data-shape="trapezoid"/>
                    <text x="450" y="130" text-anchor="middle" font-size="16" font-weight="bold" fill="#7b1fa2">æ¢¯å½¢</text>
                    
                    <!-- å¹³è¡Œå››è¾¹å½¢åŒºåŸŸ -->
                    <rect x="270" y="190" width="360" height="160" fill="url(#parallelogramGrad)" stroke="#f9a825" stroke-width="2" rx="5" data-shape="parallelogram"/>
                    <text x="450" y="240" text-anchor="middle" font-size="14" font-weight="bold" fill="#f57c00" style="cursor: pointer;">å¹³è¡Œå››é‚Šå½¢</text>                                                  
                                                            
                    <!-- é•¿æ–¹å½¢åŒºåŸŸ -->
                    <rect x="290" y="270" width="170" height="60" fill="url(#rectangleGrad)" stroke="#4caf50" stroke-width="2" rx="3" data-shape="rectangle"/>
                    <text x="365" y="305" text-anchor="middle" font-size="12" font-weight="bold" fill="#2e7d32" style="cursor: pointer;">é•·æ–¹å½¢</text>
                    
                    <!-- è±å½¢åŒºåŸŸ -->
                    <rect x="400" y="270" width="170" height="60" fill="url(#rhombusGrad)" stroke="#e91e63" stroke-width="2" rx="3" data-shape="rhombus"/>
                    <text x="535" y="305" text-anchor="middle" font-size="12" font-weight="bold" fill="#c2185b" style="cursor: pointer;">è±å½¢</text>

                    <!-- æ­£æ–¹å½¢åŒºåŸŸï¼ˆé•¿æ–¹å½¢å’Œè±å½¢çš„äº¤é›†ï¼‰ -->
                    <rect x="400" y="270" width="60" height="60" fill="url(#squareGrad)" stroke="#8bbe82" stroke-width="2" rx="2" data-shape="square"/>
                    <text x="430" y="305" text-anchor="middle" font-size="12" font-weight="bold" fill="#8bbe82" style="cursor: pointer;">æ­£æ–¹å½¢</text>                    
                </svg>
                
                <!-- åŠ¨ç”»æ§åˆ¶æŒ‰é’®åŒºåŸŸ -->
                <div class="animation-controls" style="display:none;">
                    <button id="animate-transformation-btn" class="animate-transformation-btn">
                        ğŸ”„ å†æ¬¡æ’­æ”¾
                    </button>
                    <button id="comparison-btn" class="comparison-btn">
                        ğŸ“Š é¡¯ç¤ºç‰¹æ€§å°æ¯”
                    </button>
                </div>
                
                <!-- è¿›åº¦æ¡ -->
                <div class="transformation-progress" style="display:none;">
                    <div class="progress-bar"></div>
                </div>
            </div>

            <div class="properties-panel">
                <h3 id="shape-title">æ­£æ–¹å½¢</h3>
                <div id="properties-list">
                    <!-- Properties will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <div class="relationship-network">
            <!-- å˜æ¢ä¿¡æ¯æç¤ºæ¡† -->
            <div class="relationship-info hidden">
                <h4 id="relationship-text">é»æ“Šä¸‹æ–¹ä»»ä¸€å½¢ç‹€æŸ¥çœ‹è®Šæ›æ–¹å¼</h4>
            </div>
            
            <div class="network-container">
                <!-- å½¢çŠ¶èŠ‚ç‚¹å°†ç”± JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // å››è¾¹å½¢æ•°æ®å®šä¹‰
        const shapes = {
            square: {
                points: "75,75 175,75 175,175 75,175",
                title: "æ­£æ–¹å½¢",
                properties: [
                    { text: "å››æ¢é‚Šéƒ½ç›¸ç­‰", icon: "equal", visual: "equal", category: "sides", level: "highest" },
                    { text: "å››å€‹è§’éƒ½æ˜¯ç›´è§’", icon: "right-angle", visual: "right-angle", category: "angles", level: "highest" },
                    { text: "å°é‚Šå¹³è¡Œ", icon: "parallel", visual: "parallel", category: "parallel", level: "basic" },
                    { text: "å°è§’ç·šç›¸ç­‰ä¸”å‚ç›´", icon: "diagonal", visual: "diagonal", category: "diagonals", level: "highest" }
                ],
                visualElements: {
                    parallel: { show: true },
                    equal: { show: true },
                    rightAngle: { show: true },
                    diagonal: { show: true }
                }
            },
            rectangle: {
                points: "50,75 200,75 200,175 50,175",
                title: "é•·æ–¹å½¢",
                properties: [
                    { text: "å°é‚Šç›¸ç­‰", icon: "equal", visual: "equal", category: "sides", level: "medium" },
                    { text: "å››å€‹è§’éƒ½æ˜¯ç›´è§’", icon: "right-angle", visual: "right-angle", category: "angles", level: "highest" },
                    { text: "å°é‚Šå¹³è¡Œ", icon: "parallel", visual: "parallel", category: "parallel", level: "basic" },
                    { text: "å°è§’ç·šç›¸ç­‰", icon: "diagonal", visual: "diagonal", category: "diagonals", level: "medium" }
                ],
                visualElements: {
                    parallel: { show: true },
                    equal: { show: true },
                    rightAngle: { show: true },
                    diagonal: { show: true }
                }
            },
            rhombus: {
                points: "125,70 190,125 125,180 60,125",
                title: "è±å½¢",
                properties: [
                    { text: "å››æ¢é‚Šéƒ½ç›¸ç­‰", icon: "equal", visual: "equal", category: "sides", level: "highest" },
                    { text: "å°è§’ç›¸ç­‰", icon: "right-angle", visual: "general-angle", category: "angles", level: "medium" },
                    { text: "å°é‚Šå¹³è¡Œ", icon: "parallel", visual: "parallel", category: "parallel", level: "basic" },
                    { text: "å°è§’ç·šå‚ç›´ä¸”äº’ç›¸å¹³åˆ†", icon: "diagonal", visual: "diagonal", category: "diagonals", level: "medium" }
                ],
                visualElements: {
                    parallel: { show: true },
                    equal: { show: true },
                    rightAngle: { show: false },
                    generalAngle: { show: true },
                    diagonal: { show: true }
                }
            },
            parallelogram: {
                points: "75,75 175,75 200,175 100,175",
                title: "å¹³è¡Œå››é‚Šå½¢",
                properties: [
                    { text: "å°é‚Šç›¸ç­‰", icon: "equal", visual: "equal", category: "sides", level: "medium" },
                    { text: "å°è§’ç›¸ç­‰", icon: "right-angle", visual: "general-angle", category: "angles", level: "medium" },
                    { text: "å°é‚Šå¹³è¡Œ", icon: "parallel", visual: "parallel", category: "parallel", level: "basic" },
                    { text: "å°è§’ç·šäº’ç›¸å¹³åˆ†", icon: "diagonal", visual: "diagonal", category: "diagonals", level: "low" }
                ],
                visualElements: {
                    parallel: { show: true },
                    equal: { show: true },
                    rightAngle: { show: false },
                    generalAngle: { show: true },
                    diagonal: { show: true }
                }
            },
            trapezoid: {
                points: "75,75 175,75 150,175 100,175",
                title: "æ¢¯å½¢",
                properties: [
                    { text: "æœ‰ä¸€çµ„å°é‚Šå¹³è¡Œ", icon: "parallel", visual: "parallel", category: "parallel", level: "partial" },
                    { text: "ä¸Šåº•å’Œä¸‹åº•é•·åº¦ä¸ç­‰", icon: "equal", visual: "equal", category: "sides", level: "low" },
                    { text: "å…©è…°å¯èƒ½ä¸ç­‰", icon: "equal", visual: "equal-sides", category: "sides", level: "low" }
                ],
                visualElements: {
                    parallel: { show: true, onlyOne: true },
                    equal: { show: true },
                    sides: { show: true },
                    rightAngle: { show: false },
                    diagonal: { show: false }
                }
            }
        };

        // ç‰¹æ€§åˆ†ç±»å’Œå±‚æ¬¡å®šä¹‰
        const propertyCategories = {
            sides: {
                name: "é‚Šé•·ç‰¹æ€§",
                icon: "ğŸ“",
                hierarchy: [
                    { level: "highest", text: "å››æ¢é‚Šéƒ½ç›¸ç­‰", description: "å®Œå…¨è¦å‰‡" },
                    { level: "medium", text: "å°é‚Šç›¸ç­‰", description: "éƒ¨åˆ†è¦å‰‡" },
                    { level: "low", text: "é‚Šé•·ä¸ç­‰", description: "ä¸è¦å‰‡" },
                    { level: "partial", text: "éƒ¨åˆ†é‚Šç›¸ç­‰", description: "ç‰¹æ®Šæƒ…æ³" }
                ]
            },
            angles: {
                name: "è§’åº¦ç‰¹æ€§", 
                icon: "ğŸ“",
                hierarchy: [
                    { level: "highest", text: "å››å€‹è§’éƒ½æ˜¯ç›´è§’", description: "å®Œå…¨å‚ç›´" },
                    { level: "medium", text: "å°è§’ç›¸ç­‰", description: "éƒ¨åˆ†è¦å‰‡" },
                    { level: "low", text: "è§’åº¦ä¸ç­‰", description: "ä¸è¦å‰‡" }
                ]
            },
            parallel: {
                name: "å¹³è¡Œç‰¹æ€§",
                icon: "ğŸ“„", 
                hierarchy: [
                    { level: "basic", text: "å°é‚Šå¹³è¡Œ", description: "å…©çµ„å¹³è¡Œ" },
                    { level: "partial", text: "æœ‰ä¸€çµ„å°é‚Šå¹³è¡Œ", description: "ä¸€çµ„å¹³è¡Œ" },
                    { level: "none", text: "ç„¡å¹³è¡Œé‚Š", description: "ç„¡è¦å‰‡" }
                ]
            },
            diagonals: {
                name: "å°è§’ç·šç‰¹æ€§",
                icon: "ğŸ“",
                hierarchy: [
                    { level: "highest", text: "å°è§’ç·šç›¸ç­‰ä¸”å‚ç›´", description: "å®Œå…¨ç‰¹æ®Š" },
                    { level: "medium", text: "å°è§’ç·šç›¸ç­‰æˆ–å‚ç›´", description: "éƒ¨åˆ†ç‰¹æ®Š" },
                    { level: "low", text: "å°è§’ç·šäº’ç›¸å¹³åˆ†", description: "åŸºæœ¬ç‰¹æ€§" }
                ]
            }
        };

        // å…¨å±€å˜é‡
        let currentShape = 'square';
        let isAnimating = false;
        let isComparisonMode = false;
        let isRelationshipDiagramMode = false; // æ–°å¢ï¼šå…³ç³»å›¾æ¨¡å¼æ ‡å¿—

        // åŠ¨ç”»ç›¸å…³å˜é‡
        let animationState = {
            sourceShape: null,
            targetShape: null,
            isActive: false
        };

        // å˜æ¢å…³ç³»å®šä¹‰
        const transformationPaths = {
            'trapezoid-parallelogram': 'è®“å¦ä¸€çµ„å°é‚Šä¹Ÿè®Šå¹³è¡Œ',
            'parallelogram-rectangle': 'å°‡æ‰€æœ‰è§’åº¦éƒ½è®Šç‚ºç›´è§’', 
            'parallelogram-rhombus': 'å°‡å››æ¢é‚Šéƒ½è®Šç‚ºç›¸ç­‰',
            'rectangle-square': 'å°‡å››æ¢é‚Šéƒ½è®Šç‚ºç›¸ç­‰',
            'rhombus-square': 'å°‡å››å€‹è§’éƒ½è®Šç‚ºç›´è§’',
            'rectangle-rhombus': 'æ”¹è®Šè§’åº¦ï¼Œè®“å°è§’ä¸å†éƒ½æ˜¯ç›´è§’ï¼ŒåŒæ™‚èª¿æ•´é‚Šé•·æ¯”ä¾‹',
            'rhombus-rectangle': 'å°‡å››å€‹è§’éƒ½è®Šç‚ºç›´è§’ï¼ŒåŒæ™‚èª¿æ•´é‚Šé•·æ¯”ä¾‹',
            'parallelogram-trapezoid': 'è®“ä¸€çµ„å°é‚Šä¸å†å¹³è¡Œ',
            'rectangle-parallelogram': 'æ”¹è®Šè§’åº¦ï¼Œä¸å†éƒ½æ˜¯ç›´è§’',
            'rhombus-parallelogram': 'æ”¹è®Šé‚Šé•·ï¼Œä¸å†éƒ½ç›¸ç­‰', 
            'square-rectangle': 'æ”¹è®Šé‚Šé•·æ¯”ä¾‹ï¼Œé•·å¯¬ä¸ç›¸ç­‰',
            'square-rhombus': 'æ”¹è®Šè§’åº¦ï¼Œä¸å†éƒ½æ˜¯ç›´è§’',
            'trapezoid-rectangle': 'å…ˆè®“å¦ä¸€çµ„å°é‚Šè®Šå¹³è¡Œæˆç‚ºå¹³è¡Œå››é‚Šå½¢ï¼Œå†å°‡æ‰€æœ‰è§’åº¦è®Šç‚ºç›´è§’',
            'trapezoid-rhombus': 'å…ˆè®“å¦ä¸€çµ„å°é‚Šè®Šå¹³è¡Œæˆç‚ºå¹³è¡Œå››é‚Šå½¢ï¼Œå†å°‡å››æ¢é‚Šéƒ½è®Šç‚ºç›¸ç­‰',
            'trapezoid-square': 'å…ˆè®Šç‚ºå¹³è¡Œå››é‚Šå½¢ï¼Œå†é€šéé•·æ–¹å½¢æˆ–è±å½¢çš„è·¯å¾‘æœ€çµ‚è®Šç‚ºæ­£æ–¹å½¢',
            'rectangle-trapezoid': 'å…ˆæ”¹è®Šè§’åº¦è®Šç‚ºå¹³è¡Œå››é‚Šå½¢ï¼Œå†è®“ä¸€çµ„å°é‚Šä¸å†å¹³è¡Œ',
            'rhombus-trapezoid': 'å…ˆæ”¹è®Šé‚Šé•·è®Šç‚ºå¹³è¡Œå››é‚Šå½¢ï¼Œå†è®“ä¸€çµ„å°é‚Šä¸å†å¹³è¡Œ',
            'square-trapezoid': 'å…ˆé€€åŒ–ç‚ºé•·æ–¹å½¢æˆ–è±å½¢ï¼Œå†è®Šç‚ºå¹³è¡Œå››é‚Šå½¢ï¼Œæœ€å¾Œè®“ä¸€çµ„å°é‚Šä¸å†å¹³è¡Œ',
            'square-parallelogram': 'æ”¹è®Šé‚Šé•·æ¯”ä¾‹æˆ–è§’åº¦ï¼Œå¤±å»æ­£æ–¹å½¢çš„å®Œç¾å°ç¨±æ€§'
        };

        /**
         * è·å–å½¢çŠ¶åœ¨ç‰¹å®šç±»åˆ«ä¸­çš„ç‰¹æ€§
         */
        function getShapePropertyInCategory(shapeName, category) {
            const shape = shapes[shapeName];
            if (!shape) return null;
            
            return shape.properties.find(prop => prop.category === category) || null;
        }

        /**
         * è·å–ç‰¹æ€§çš„å±‚æ¬¡çº§åˆ«æè¿°
         */
        function getPropertyLevelInfo(category, level) {
            const categoryInfo = propertyCategories[category];
            if (!categoryInfo) return null;
            
            return categoryInfo.hierarchy.find(h => h.level === level) || null;
        }

        /**
         * æ¯”è¾ƒä¸¤ä¸ªç‰¹æ€§çš„å±‚æ¬¡å…³ç³»
         */
        function comparePropertyLevels(sourceProp, targetProp) {
            if (!sourceProp && !targetProp) {
                return { type: 'same', icon: 'â–', color: '#999', description: 'å‡ç„¡æ­¤ç‰¹æ€§' };
            }
            
            if (!sourceProp && targetProp) {
                return { type: 'gain', icon: 'â•', color: '#4CAF50', description: 'ç²å¾—æ–°ç‰¹æ€§' };
            }
            
            if (sourceProp && !targetProp) {
                return { type: 'lose', icon: 'â–', color: '#FF6B6B', description: 'å¤±å»ç‰¹æ€§' };
            }
            
            if (sourceProp.level === targetProp.level) {
                if (sourceProp.text === targetProp.text) {
                    return { type: 'same', icon: 'âœ“', color: '#666', description: 'ä¿æŒä¸è®Š' };
                } else {
                    return { type: 'change', icon: 'ğŸ”„', color: '#FF9800', description: 'åŒç´šè®ŠåŒ–' };
                }
            }
            
            // å®šä¹‰å±‚æ¬¡ä¼˜å…ˆçº§
            const levelPriority = { 'highest': 4, 'medium': 3, 'basic': 2, 'partial': 1, 'low': 0, 'none': -1 };
            const sourceLevel = levelPriority[sourceProp.level] || 0;
            const targetLevel = levelPriority[targetProp.level] || 0;
            
            if (targetLevel > sourceLevel) {
                return { type: 'upgrade', icon: 'â¬†ï¸', color: '#4CAF50', description: 'ç‰¹æ€§æå‡' };
            } else {
                return { type: 'downgrade', icon: 'â¬‡ï¸', color: '#FF6B6B', description: 'ç‰¹æ€§é™ç´š' };
            }
        }

        /**
         * è·å–å±‚æ¬¡å…³ç³»è¯´æ˜æ–‡æœ¬
         */
        function getRelationshipInfo(sourceProp, targetProp, category) {
            if (!sourceProp || !targetProp || sourceProp.level === targetProp.level) {
                return '';
            }
            
            if (category === 'sides') {
                if (sourceProp.level === 'medium' && targetProp.level === 'highest') {
                    return 'ğŸ’¡ "å››æ¢é‚Šéƒ½ç›¸ç­‰" åŒ…å«äº† "å°é‚Šç›¸ç­‰"';
                } else if (sourceProp.level === 'highest' && targetProp.level === 'medium') {
                    return 'âš ï¸ å¾å®Œå…¨è¦å‰‡é€€åŒ–ç‚ºéƒ¨åˆ†è¦å‰‡';
                }
            } else if (category === 'parallel') {
                if (sourceProp.level === 'partial' && targetProp.level === 'basic') {
                    return 'ğŸ’¡ å¾ä¸€çµ„å¹³è¡Œæå‡ç‚ºå…©çµ„å¹³è¡Œ';
                } else if (sourceProp.level === 'basic' && targetProp.level === 'partial') {
                    return 'âš ï¸ å¾å…©çµ„å¹³è¡Œé€€åŒ–ç‚ºä¸€çµ„å¹³è¡Œ';
                }
            } else if (category === 'angles') {
                if (sourceProp.level === 'medium' && targetProp.level === 'highest') {
                    return 'ğŸ’¡ å¾å°è§’ç›¸ç­‰æå‡ç‚ºå››å€‹ç›´è§’';
                } else if (sourceProp.level === 'highest' && targetProp.level === 'medium') {
                    return 'âš ï¸ å¾å››å€‹ç›´è§’é€€åŒ–ç‚ºå°è§’ç›¸ç­‰';
                }
            } else if (category === 'diagonals') {
                if (sourceProp.level === 'low' && targetProp.level === 'medium') {
                    return 'ğŸ’¡ å°è§’ç·šç‰¹æ€§å¾—åˆ°å¢å¼·';
                } else if (sourceProp.level === 'medium' && targetProp.level === 'highest') {
                    return 'ğŸ’¡ å°è§’ç·šé”åˆ°æœ€å®Œç¾ç‹€æ…‹';
                } else if (sourceProp.level === 'highest' && targetProp.level === 'medium') {
                    return 'âš ï¸ å°è§’ç·šç‰¹æ€§æœ‰æ‰€æ¸›å¼±';
                }
            }
            
            return '';
        }

        /**
         * æ›´æ–°è§†è§‰æ ‡è®°
         */
        function updateVisualMarkers(shapeName) {
            const shape = shapes[shapeName];
            if (!shape || !shape.visualElements) return;
            
            const points = shape.points.split(' ').map(p => {
                const [x, y] = p.split(',').map(Number);
                return { x, y };
            });

            // æ¸…é™¤æ‰€æœ‰æ ‡è®°
            document.querySelectorAll('.visual-element').forEach(el => {
                el.style.display = 'none';
            });

            // æ¸…é™¤æ‰€æœ‰è§’åº¦æ ‡è®°
            for (let i = 1; i <= 4; i++) {
                const angleDot = document.getElementById(`angle-dot${i}`);
                if (angleDot) {
                    angleDot.setAttribute('r', '0');
                    angleDot.setAttribute('cx', '0');
                    angleDot.setAttribute('cy', '0');
                }
            }

            // è®¾ç½®å¹³è¡Œçº¿æ ‡è®°
            if (shape.visualElements.parallel.show) {
                const parallelMarks = document.getElementById('parallel-marks');
                parallelMarks.style.display = 'block';
                
                if (shapeName === 'trapezoid') {
                    // æ¢¯å½¢åªæ˜¾ç¤ºä¸€ç»„å¹³è¡Œçº¿
                    const topMidX = (points[0].x + points[1].x) / 2;
                    const topMidY = (points[0].y + points[1].y) / 2;
                    const bottomMidX = (points[2].x + points[3].x) / 2;
                    const bottomMidY = (points[2].y + points[3].y) / 2;
                    
                    const parallel1a = document.getElementById('parallel1a');
                    const parallel1b = document.getElementById('parallel1b');
                    if (parallel1a && parallel1b) {
                        parallel1a.setAttribute('x1', topMidX - 8);
                        parallel1a.setAttribute('y1', topMidY - 5);
                        parallel1a.setAttribute('x2', topMidX + 8);
                        parallel1a.setAttribute('y2', topMidY - 5);
                        
                        parallel1b.setAttribute('x1', bottomMidX - 8);
                        parallel1b.setAttribute('y1', bottomMidY + 5);
                        parallel1b.setAttribute('x2', bottomMidX + 8);
                        parallel1b.setAttribute('y2', bottomMidY + 5);
                    }
                    
                    const parallel2a = document.getElementById('parallel2a');
                    const parallel2b = document.getElementById('parallel2b');
                    if (parallel2a && parallel2b) {
                        parallel2a.setAttribute('x1', 0);
                        parallel2a.setAttribute('y1', 0);
                        parallel2a.setAttribute('x2', 0);
                        parallel2a.setAttribute('y2', 0);
                        
                        parallel2b.setAttribute('x1', 0);
                        parallel2b.setAttribute('y1', 0);
                        parallel2b.setAttribute('x2', 0);
                        parallel2b.setAttribute('y2', 0);
                    }
                } else {
                    // å…¶ä»–å½¢çŠ¶æ˜¾ç¤ºä¸¤ç»„å¹³è¡Œçº¿
                    const topMidX = (points[0].x + points[1].x) / 2;
                    const topMidY = (points[0].y + points[1].y) / 2;
                    const bottomMidX = (points[2].x + points[3].x) / 2;
                    const bottomMidY = (points[2].y + points[3].y) / 2;
                    
                    const parallel1a = document.getElementById('parallel1a');
                    const parallel1b = document.getElementById('parallel1b');
                    if (parallel1a && parallel1b) {
                        parallel1a.setAttribute('x1', topMidX - 8);
                        parallel1a.setAttribute('y1', topMidY - 5);
                        parallel1a.setAttribute('x2', topMidX + 8);
                        parallel1a.setAttribute('y2', topMidY - 5);
                        
                        parallel1b.setAttribute('x1', bottomMidX - 8);
                        parallel1b.setAttribute('y1', bottomMidY + 5);
                        parallel1b.setAttribute('x2', bottomMidX + 8);
                        parallel1b.setAttribute('y2', bottomMidY + 5);
                    }

                    const leftMidX = (points[0].x + points[3].x) / 2;
                    const leftMidY = (points[0].y + points[3].y) / 2;
                    const rightMidX = (points[1].x + points[2].x) / 2;
                    const rightMidY = (points[1].y + points[2].y) / 2;
                    
                    const parallel2a = document.getElementById('parallel2a');
                    const parallel2b = document.getElementById('parallel2b');
                    if (parallel2a && parallel2b) {
                        parallel2a.setAttribute('x1', leftMidX - 5);
                        parallel2a.setAttribute('y1', leftMidY - 8);
                        parallel2a.setAttribute('x2', leftMidX - 5);
                        parallel2a.setAttribute('y2', leftMidY + 8);
                        
                        parallel2b.setAttribute('x1', rightMidX + 5);
                        parallel2b.setAttribute('y1', rightMidY - 8);
                        parallel2b.setAttribute('x2', rightMidX + 5);
                        parallel2b.setAttribute('y2', rightMidY + 8);
                    }
                }
            }

            // è®¾ç½®ç›´è§’æ ‡è®°
            if (shape.visualElements.rightAngle && shape.visualElements.rightAngle.show) {
                const angleMarks = document.getElementById('angle-marks');
                angleMarks.style.display = 'block';
                
                for (let i = 0; i < 4; i++) {
                    const angle = document.getElementById(`angle${i + 1}`);
                    if (angle) {
                        const corner = points[i];
                        angle.setAttribute('x', corner.x - 7.5);
                        angle.setAttribute('y', corner.y - 7.5);
                    }
                }
            }

            // è®¾ç½®ä¸€èˆ¬è§’åº¦æ ‡è®°
            if (shape.visualElements.generalAngle && shape.visualElements.generalAngle.show) {
                const angleMarksGeneral = document.getElementById('angle-marks-general');
                angleMarksGeneral.style.display = 'block';
                
                for (let i = 1; i <= 4; i++) {
                    const angleDot = document.getElementById(`angle-dot${i}`);
                    if (angleDot) {
                        angleDot.setAttribute('r', '0');
                        angleDot.setAttribute('cx', '0');
                        angleDot.setAttribute('cy', '0');
                    }
                }
                
                if (shapeName === 'rhombus') {
                    // è±å½¢è§’åº¦æ ‡è®°
                    const corner0 = points[0];
                    const corner1 = points[1];
                    const corner2 = points[2];
                    const corner3 = points[3];
                    
                    const dot1 = document.getElementById('angle-dot1');
                    const dot3 = document.getElementById('angle-dot3');
                    if (dot1 && dot3) {
                        dot1.setAttribute('cx', corner0.x);
                        dot1.setAttribute('cy', corner0.y);
                        dot1.setAttribute('r', '3');
                        
                        dot3.setAttribute('cx', corner2.x);
                        dot3.setAttribute('cy', corner2.y);
                        dot3.setAttribute('r', '3');
                    }
                    
                    const dot2 = document.getElementById('angle-dot2');
                    const dot4 = document.getElementById('angle-dot4');
                    if (dot2 && dot4) {
                        dot2.setAttribute('cx', corner1.x);
                        dot2.setAttribute('cy', corner1.y);
                        dot2.setAttribute('r', '5');
                        
                        dot4.setAttribute('cx', corner3.x);
                        dot4.setAttribute('cy', corner3.y);
                        dot4.setAttribute('r', '5');
                    }
                    
                } else if (shapeName === 'parallelogram') {
                    // å¹³è¡Œå››è¾¹å½¢è§’åº¦æ ‡è®°
                    for (let i = 0; i < 4; i++) {
                        const angleDot = document.getElementById(`angle-dot${i + 1}`);
                        if (angleDot) {
                            const corner = points[i];
                            angleDot.setAttribute('cx', corner.x);
                            angleDot.setAttribute('cy', corner.y);
                            
                            if (i === 0 || i === 2) {
                                angleDot.setAttribute('r', '3');
                            } else {
                                angleDot.setAttribute('r', '5');
                            }
                        }
                    }
                }
            } else {
                const angleMarksGeneral = document.getElementById('angle-marks-general');
                if (angleMarksGeneral) {
                    angleMarksGeneral.style.display = 'none';
                }
            }

            // è®¾ç½®ç›¸ç­‰è¾¹æ ‡è®°
            if (shape.visualElements.equal && shape.visualElements.equal.show) {
                const equalMarks = document.getElementById('equal-marks');
                equalMarks.style.display = 'block';
                
                if (shapeName === 'trapezoid') {
                    // æ¢¯å½¢çš„ç‰¹æ®Šå¤„ç†
                    for (let i = 1; i <= 4; i++) {
                        const equalA = document.getElementById(`equal${i}a`);
                        const equalB = document.getElementById(`equal${i}b`);
                        if (equalA && equalB) {
                            equalA.setAttribute('x1', 0);
                            equalA.setAttribute('y1', 0);
                            equalA.setAttribute('x2', 0);
                            equalA.setAttribute('y2', 0);
                            equalB.setAttribute('x1', 0);
                            equalB.setAttribute('y1', 0);
                            equalB.setAttribute('x2', 0);
                            equalB.setAttribute('y2', 0);
                        }
                    }
                    
                    // ä¸Šè¾¹æ ‡è®°
                    const topMidX = (points[0].x + points[1].x) / 2;
                    const topMidY = (points[0].y + points[1].y) / 2;
                    const equal1a = document.getElementById('equal1a');
                    if (equal1a) {
                        equal1a.setAttribute('x1', topMidX - 5);
                        equal1a.setAttribute('y1', topMidY - 3);
                        equal1a.setAttribute('x2', topMidX + 5);
                        equal1a.setAttribute('y2', topMidY - 3);
                    }
                    
                    // ä¸‹è¾¹æ ‡è®°
                    const bottomMidX = (points[2].x + points[3].x) / 2;
                    const bottomMidY = (points[2].y + points[3].y) / 2;
                    const equal3a = document.getElementById('equal3a');
                    const equal3b = document.getElementById('equal3b');
                    if (equal3a && equal3b) {
                        equal3a.setAttribute('x1', bottomMidX - 5);
                        equal3a.setAttribute('y1', bottomMidY + 3);
                        equal3a.setAttribute('x2', bottomMidX + 5);
                        equal3a.setAttribute('y2', bottomMidY + 3);
                        equal3b.setAttribute('x1', bottomMidX - 5);
                        equal3b.setAttribute('y1', bottomMidY + 6);
                        equal3b.setAttribute('x2', bottomMidX + 5);
                        equal3b.setAttribute('y2', bottomMidY + 6);
                    }
                    
                    // è®¾ç½®ä¸¤è…°æ ‡è®°
                    const sidesMarks = document.getElementById('sides-marks');
                    sidesMarks.style.display = 'block';
                    
                    const leftWaistMidX = (points[0].x + points[3].x) / 2;
                    const leftWaistMidY = (points[0].y + points[3].y) / 2;
                    const side1a = document.getElementById('side1a');
                    if (side1a) {
                        side1a.setAttribute('x1', leftWaistMidX - 3);
                        side1a.setAttribute('y1', leftWaistMidY - 3);
                        side1a.setAttribute('x2', leftWaistMidX - 3);
                        side1a.setAttribute('y2', leftWaistMidY + 3);
                    }
                    
                    const rightWaistMidX = (points[1].x + points[2].x) / 2;
                    const rightWaistMidY = (points[1].y + points[2].y) / 2;
                    const side2a = document.getElementById('side2a');
                    const side2b = document.getElementById('side2b');
                    if (side2a && side2b) {
                        side2a.setAttribute('x1', rightWaistMidX + 3);
                        side2a.setAttribute('y1', rightWaistMidY - 3);
                        side2a.setAttribute('x2', rightWaistMidX + 3);
                        side2a.setAttribute('y2', rightWaistMidY + 3);
                        side2b.setAttribute('x1', rightWaistMidX + 6);
                        side2b.setAttribute('y1', rightWaistMidY - 3);
                        side2b.setAttribute('x2', rightWaistMidX + 6);
                        side2b.setAttribute('y2', rightWaistMidY + 3);
                    }
                } else {
                    // å…¶ä»–å½¢çŠ¶çš„ç›¸ç­‰è¾¹æ ‡è®°
                    const sidesMarks = document.getElementById('sides-marks');
                    if (sidesMarks) {
                        sidesMarks.style.display = 'none';
                    }
                    
                    for (let i = 1; i <= 4; i++) {
                        const equalA = document.getElementById(`equal${i}a`);
                        const equalB = document.getElementById(`equal${i}b`);
                        if (equalA && equalB) {
                            equalA.setAttribute('x1', 0);
                            equalA.setAttribute('y1', 0);
                            equalA.setAttribute('x2', 0);
                            equalA.setAttribute('y2', 0);
                            equalB.setAttribute('x1', 0);
                            equalB.setAttribute('y1', 0);
                            equalB.setAttribute('x2', 0);
                            equalB.setAttribute('y2', 0);
                        }
                    }
                    
                    if (shapeName === 'rectangle' || shapeName === 'parallelogram') {
                        // å¯¹è¾¹ç›¸ç­‰æ ‡è®°
                        const topMidX = (points[0].x + points[1].x) / 2;
                        const topMidY = (points[0].y + points[1].y) / 2;
                        const equal1a = document.getElementById('equal1a');
                        if (equal1a) {
                            equal1a.setAttribute('x1', topMidX - 5);
                            equal1a.setAttribute('y1', topMidY - 3);
                            equal1a.setAttribute('x2', topMidX + 5);
                            equal1a.setAttribute('y2', topMidY - 3);
                        }
                        
                        const bottomMidX = (points[2].x + points[3].x) / 2;
                        const bottomMidY = (points[2].y + points[3].y) / 2;
                        const equal3a = document.getElementById('equal3a');
                        if (equal3a) {
                            equal3a.setAttribute('x1', bottomMidX - 5);
                            equal3a.setAttribute('y1', bottomMidY + 3);
                            equal3a.setAttribute('x2', bottomMidX + 5);
                            equal3a.setAttribute('y2', bottomMidY + 3);
                        }
                        
                        const leftMidX = (points[0].x + points[3].x) / 2;
                        const leftMidY = (points[0].y + points[3].y) / 2;
                        const equal2a = document.getElementById('equal2a');
                        const equal2b = document.getElementById('equal2b');
                        if (equal2a && equal2b) {
                            equal2a.setAttribute('x1', leftMidX - 3);
                            equal2a.setAttribute('y1', leftMidY - 3);
                            equal2a.setAttribute('x2', leftMidX - 3);
                            equal2a.setAttribute('y2', leftMidY + 3);
                            equal2b.setAttribute('x1', leftMidX - 6);
                            equal2b.setAttribute('y1', leftMidY - 3);
                            equal2b.setAttribute('x2', leftMidX - 6);
                            equal2b.setAttribute('y2', leftMidY + 3);
                        }
                        
                        const rightMidX = (points[1].x + points[2].x) / 2;
                        const rightMidY = (points[1].y + points[2].y) / 2;
                        const equal4a = document.getElementById('equal4a');
                        const equal4b = document.getElementById('equal4b');
                        if (equal4a && equal4b) {
                            equal4a.setAttribute('x1', rightMidX + 3);
                            equal4a.setAttribute('y1', rightMidY - 3);
                            equal4a.setAttribute('x2', rightMidX + 3);
                            equal4a.setAttribute('y2', rightMidY + 3);
                            equal4b.setAttribute('x1', rightMidX + 6);
                            equal4b.setAttribute('y1', rightMidY - 3);
                            equal4b.setAttribute('x2', rightMidX + 6);
                            equal4b.setAttribute('y2', rightMidY + 3);
                        }
                    } else {
                        // å››è¾¹éƒ½ç›¸ç­‰çš„æ ‡è®°ï¼ˆæ­£æ–¹å½¢ã€è±å½¢ï¼‰
                        for (let i = 0; i < 4; i++) {
                            const p1 = points[i];
                            const p2 = points[(i + 1) % 4];
                            const midX = (p1.x + p2.x) / 2;
                            const midY = (p1.y + p2.y) / 2;
                            
                            const equalA = document.getElementById(`equal${i + 1}a`);
                            const equalB = document.getElementById(`equal${i + 1}b`);
                            
                            if (equalA && equalB) {
                                if (i % 2 === 0) {
                                    equalA.setAttribute('x1', midX - 3);
                                    equalA.setAttribute('y1', midY - 3);
                                    equalA.setAttribute('x2', midX + 3);
                                    equalA.setAttribute('y2', midY - 3);
                                    equalB.setAttribute('x1', midX - 3);
                                    equalB.setAttribute('y1', midY + 3);
                                    equalB.setAttribute('x2', midX + 3);
                                    equalB.setAttribute('y2', midY + 3);
                                } else {
                                    equalA.setAttribute('x1', midX - 3);
                                    equalA.setAttribute('y1', midY - 3);
                                    equalA.setAttribute('x2', midX - 3);
                                    equalA.setAttribute('y2', midY + 3);
                                    equalB.setAttribute('x1', midX + 3);
                                    equalB.setAttribute('y1', midY - 3);
                                    equalB.setAttribute('x2', midX + 3);
                                    equalB.setAttribute('y2', midY + 3);
                                }
                            }
                        }
                    }
                }
            } else {
                const sidesMarks = document.getElementById('sides-marks');
                if (sidesMarks) {
                    sidesMarks.style.display = 'none';
                }
            }

            // è®¾ç½®å¯¹è§’çº¿
            if (shape.visualElements.diagonal && shape.visualElements.diagonal.show) {
                const diagonalMarks = document.getElementById('diagonal-marks');
                diagonalMarks.style.display = 'block';
                
                const diagonal1 = document.getElementById('diagonal1');
                const diagonal2 = document.getElementById('diagonal2');
                if (diagonal1 && diagonal2) {
                    diagonal1.setAttribute('x1', points[0].x);
                    diagonal1.setAttribute('y1', points[0].y);
                    diagonal1.setAttribute('x2', points[2].x);
                    diagonal1.setAttribute('y2', points[2].y);
                    
                    diagonal2.setAttribute('x1', points[1].x);
                    diagonal2.setAttribute('y1', points[1].y);
                    diagonal2.setAttribute('x2', points[3].x);
                    diagonal2.setAttribute('y2', points[3].y);
                }
            }
        }

        /**
         * é«˜äº®æŒ‡å®šçš„è§†è§‰å…ƒç´ 
         */
        function highlightVisualElement(visualType) {
            document.querySelectorAll('.visual-element').forEach(el => {
                el.classList.remove('highlight');
            });

            let targetElement = null;
            switch(visualType) {
                case 'parallel':
                    targetElement = document.getElementById('parallel-marks');
                    break;
                case 'equal':
                    targetElement = document.getElementById('equal-marks');
                    break;
                case 'equal-sides':
                    targetElement = document.getElementById('sides-marks');
                    break;
                case 'right-angle':
                    targetElement = document.getElementById('angle-marks');
                    break;
                case 'general-angle':
                    targetElement = document.getElementById('angle-marks-general');
                    break;
                case 'diagonal':
                    targetElement = document.getElementById('diagonal-marks');
                    break;
            }
            
            if (targetElement) {
                targetElement.style.display = 'block';
                targetElement.classList.add('highlight');
            }
        }

        /**
         * æ¸…é™¤è§†è§‰é«˜äº®
         */
        function clearVisualHighlights() {
            document.querySelectorAll('.visual-element').forEach(el => {
                el.classList.remove('highlight');
            });
        }

        /**
         * æ˜¾ç¤ºæŒ‡å®šå½¢çŠ¶
         */
        function displayShape(shapeName) {
            if (isAnimating) return;
            
            const shape = shapes[shapeName];
            if (!shape) return;
            
            const polygon = document.getElementById('main-shape');
            const title = document.getElementById('shape-title');
            const propertiesList = document.getElementById('properties-list');

            polygon.classList.add('morphing');
            
            setTimeout(() => {
                polygon.setAttribute('points', shape.points);
                polygon.classList.remove('morphing');
                updateVisualMarkers(shapeName);
            }, 200);

            title.textContent = shape.title;
            clearVisualHighlights();
            
            propertiesList.innerHTML = '';
            shape.properties.forEach((prop, index) => {
                setTimeout(() => {
                    const propertyDiv = document.createElement('div');
                    propertyDiv.className = 'property';
                    propertyDiv.style.transform = 'translateX(0)';
                    propertyDiv.style.opacity = '1';
                    propertyDiv.innerHTML = `
                        <div class="property-icon ${prop.icon}"></div>
                        <span>${prop.text}</span>
                    `;
                    
                    propertyDiv.addEventListener('click', () => {
                        document.querySelectorAll('.property').forEach(p => {
                            p.classList.remove('highlight');
                        });
                        
                        propertyDiv.classList.add('highlight');
                        
                        if (prop.visual) {
                            highlightVisualElement(prop.visual);
                        }
                    });
                    
                    propertiesList.appendChild(propertyDiv);
                }, index * 200);
            });

            currentShape = shapeName;
            isComparisonMode = false;
            
            // æ›´æ–°å˜æ¢åŒºåŸŸæ˜¾ç¤º
            updateTransformationArea(shapeName);
        }

        /**
         * æ˜¾ç¤ºå…³ç³»å›¾
         */
        function showRelationshipDiagram() {
            isRelationshipDiagramMode = true;
            
            // éšè—å½¢çŠ¶æ˜¾ç¤ºSVGå’Œå±æ€§é¢æ¿
            const shapeSvg = document.getElementById('shape-svg');
            const relationshipSvg = document.getElementById('relationship-svg');
            const propertiesPanel = document.querySelector('.properties-panel');
            const relationshipNetwork = document.querySelector('.relationship-network');
            
            shapeSvg.style.display = 'none';
            relationshipSvg.style.display = 'block';
            propertiesPanel.style.display = 'none';
            relationshipNetwork.style.display = 'none';
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.shape-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const diagramBtn = document.getElementById('relationship-diagram-btn');
            diagramBtn.classList.add('active');
            diagramBtn.textContent = 'ğŸ”™ è¿”å›å½¢ç‹€å­¸ç¿’';
            
            // é‡ç½®å…¶ä»–çŠ¶æ€
            resetTransformationState();
        }

        /**
         * éšè—å…³ç³»å›¾ï¼Œåˆ‡æ¢å›å½¢çŠ¶æ˜¾ç¤º
         */
        function hideRelationshipDiagram() {
            isRelationshipDiagramMode = false;
            
            // æ˜¾ç¤ºå½¢çŠ¶æ˜¾ç¤ºSVGå’Œå±æ€§é¢æ¿
            const shapeSvg = document.getElementById('shape-svg');
            const relationshipSvg = document.getElementById('relationship-svg');
            const propertiesPanel = document.querySelector('.properties-panel');
            const relationshipNetwork = document.querySelector('.relationship-network');
            
            shapeSvg.style.display = 'block';
            relationshipSvg.style.display = 'none';
            propertiesPanel.style.display = 'block';
            relationshipNetwork.style.display = 'block';
            
            // æ¢å¤æŒ‰é’®çŠ¶æ€
            const diagramBtn = document.getElementById('relationship-diagram-btn');
            diagramBtn.classList.remove('active');
            diagramBtn.textContent = 'åœ–å½¢é—œä¿‚åœ–';
        }

        /**
         * æ›´æ–°å˜æ¢åŒºåŸŸæ˜¾ç¤º
         */
        function updateTransformationArea(currentShapeName) {
            const networkContainer = document.querySelector('.network-container');
            const relationshipInfo = document.querySelector('.relationship-info');
            const relationshipText = document.getElementById('relationship-text');
            const animationControls = document.querySelector('.animation-controls');
            const progressContainer = document.querySelector('.transformation-progress');
            
            // é‡ç½®çŠ¶æ€
            resetTransformationState();
            
            // æ¸…ç©ºç°æœ‰èŠ‚ç‚¹
            networkContainer.innerHTML = '';
            
            // è·å–æ‰€æœ‰å½¢çŠ¶ï¼Œæ’é™¤å½“å‰å½¢çŠ¶
            const allShapes = ['trapezoid', 'parallelogram', 'rectangle', 'rhombus', 'square'];
            const availableShapes = allShapes.filter(shape => shape !== currentShapeName);
            
            // åŠ¨æ€åˆ›å»ºå½¢çŠ¶èŠ‚ç‚¹
            availableShapes.forEach((shapeName, index) => {
                setTimeout(() => {
                    const shapeNode = document.createElement('div');
                    shapeNode.className = `shape-node ${shapeName}`;
                    shapeNode.dataset.shape = shapeName;
                    
                    // è®¾ç½®èŠ‚ç‚¹æ ·å¼å’Œå†…å®¹
                    switch(shapeName) {
                        case 'trapezoid':
                            shapeNode.textContent = 'æ¢¯å½¢';
                            break;
                        case 'parallelogram':
                            shapeNode.innerHTML = '<span>å¹³è¡Œå››é‚Šå½¢</span>';
                            break;
                        case 'rectangle':
                            shapeNode.textContent = 'é•·æ–¹å½¢';
                            break;
                        case 'rhombus':
                            shapeNode.innerHTML = '<span>è±å½¢</span>';
                            break;
                        case 'square':
                            shapeNode.textContent = 'æ­£æ–¹å½¢';
                            break;
                    }
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    shapeNode.addEventListener('click', (e) => {
                        e.stopPropagation();
                        handleShapeTransformation(currentShapeName, shapeName);
                    });
                    
                    // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                    shapeNode.style.opacity = '0';
                    shapeNode.style.transition = 'all 0.3s ease';
                    
                    // ä¸ºç‰¹æ®Šå½¢çŠ¶ä¿ç•™åŸæœ‰å˜æ¢ï¼Œåªæ·»åŠ ç¼©æ”¾
                    if (shapeName === 'parallelogram') {
                        shapeNode.style.transform = 'skewX(-20deg) scale(0.8)';
                    } else if (shapeName === 'rhombus') {
                        shapeNode.style.transform = 'rotate(45deg) scale(0.8)';
                    } else {
                        shapeNode.style.transform = 'scale(0.8)';
                    }
                    
                    networkContainer.appendChild(shapeNode);
                    
                    // è§¦å‘åŠ¨ç”»
                    setTimeout(() => {
                        shapeNode.style.opacity = '1';
                        if (shapeName === 'parallelogram') {
                            shapeNode.style.transform = 'skewX(-20deg) scale(1)';
                        } else if (shapeName === 'rhombus') {
                            shapeNode.style.transform = 'rotate(45deg) scale(1)';
                        } else {
                            shapeNode.style.transform = 'scale(1)';
                        }
                    }, 50);
                    
                }, index * 150);
            });
            
            // æ›´æ–°æç¤ºä¿¡æ¯
            relationshipInfo.classList.remove('hidden', 'transformation');
            relationshipText.innerHTML = `é»æ“Šä¸‹æ–¹ä»»ä¸€å½¢ç‹€æŸ¥çœ‹è®Šæ›æ–¹å¼åŠæ¯”è¼ƒç‰¹æ€§`;
        }

        /**
         * å¤„ç†å½¢çŠ¶å˜æ¢
         */
        function handleShapeTransformation(sourceShape, targetShape) {
            const description = getTransformationDescription(sourceShape, targetShape);
            const relationshipInfo = document.querySelector('.relationship-info');
            const relationshipText = document.getElementById('relationship-text');
            const animationControls = document.querySelector('.animation-controls');
            const animateBtn = document.getElementById('animate-transformation-btn');
            const comparisonBtn = document.getElementById('comparison-btn');
            
            // å¦‚æœå½“å‰å¤„äºå¯¹æ¯”æ¨¡å¼ï¼Œå…ˆåˆ‡æ¢å›å½¢çŠ¶è¯¦æƒ…
            if (isComparisonMode) {
                displayShape(targetShape);
                isComparisonMode = false;
            }
            
            // ä¿å­˜å˜æ¢çŠ¶æ€
            animationState.sourceShape = sourceShape;
            animationState.targetShape = targetShape;
            
            // é«˜äº®é€‰ä¸­çš„ç›®æ ‡å½¢çŠ¶
            document.querySelectorAll('.shape-node').forEach(node => {
                node.classList.remove('active');
                node.style.backgroundColor = '';
            });
            
            const targetNode = document.querySelector(`.shape-node[data-shape="${targetShape}"]`);
            if (targetNode) {
                targetNode.classList.add('active');
                targetNode.style.backgroundColor = '#4CAF50';
            }
            
            // æ›´æ–°æç¤ºä¿¡æ¯
            relationshipInfo.classList.remove('hidden');
            relationshipInfo.classList.add('transformation');
            relationshipText.innerHTML = `
                <strong>${shapes[sourceShape].title} â†’ ${shapes[targetShape].title}</strong><br>
                ${description}
            `;
            
            // éšè—æ§åˆ¶æŒ‰é’®ï¼Œç›´æ¥å¼€å§‹åŠ¨ç”»
            animationControls.style.display = 'none';
            
            // ç›´æ¥æ’­æ”¾åŠ¨ç”»
            animateTransformation(sourceShape, targetShape);
        }

        /**
         * åˆ‡æ¢ç‰¹æ€§å¯¹æ¯”æ˜¾ç¤º
         */
        function toggleComparison(sourceShape, targetShape) {
            const comparisonBtn = document.getElementById('comparison-btn');
            
            if (isComparisonMode) {
                // å½“å‰æ˜¯å¯¹æ¯”æ¨¡å¼ï¼Œåˆ‡æ¢å›ç›®æ ‡å½¢çŠ¶è¯¦æƒ…
                displayShape(sourceShape);
                comparisonBtn.textContent = 'ğŸ“Š é¡¯ç¤ºç‰¹æ€§å°æ¯”';
                isComparisonMode = false;
            } else {
                // å½“å‰æ˜¯å½¢çŠ¶è¯¦æƒ…ï¼Œåˆ‡æ¢åˆ°å¯¹æ¯”æ¨¡å¼
                displayShapeComparison(sourceShape, targetShape);
                comparisonBtn.textContent = 'ğŸ“‹ è¿”å›å½¢ç‹€è©³æƒ…';
                isComparisonMode = true;
            }
        }

        /**
         * é‡ç½®å˜æ¢çŠ¶æ€
         */
        function resetTransformationState() {
            const relationshipInfo = document.querySelector('.relationship-info');
            const animationControls = document.querySelector('.animation-controls');
            const progressContainer = document.querySelector('.transformation-progress');
            
            // æ¸…é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.shape-node').forEach(node => {
                node.classList.remove('active');
                node.style.backgroundColor = '';
            });
            
            // éšè—æ§åˆ¶æŒ‰é’®å’Œè¿›åº¦æ¡
            animationControls.style.display = 'none';
            progressContainer.style.display = 'none';
            
            isComparisonMode = false;
        }

        /**
         * å¤„ç†å½¢çŠ¶é€‰æ‹©ï¼ˆç®€åŒ–ç‰ˆï¼Œä¸»è¦ç”¨äºé¡¶éƒ¨æŒ‰é’®ï¼‰
         */
        function handleShapeSelection(shapeName) {
            // å¦‚æœå½“å‰åœ¨å…³ç³»å›¾æ¨¡å¼ï¼Œå…ˆåˆ‡æ¢å›å½¢çŠ¶æ˜¾ç¤º
            if (isRelationshipDiagramMode) {
                hideRelationshipDiagram();
            }
            
            resetTransformationState();
            updateActiveShape(shapeName);
            displayShape(shapeName);
        }

        /**
         * æ˜¾ç¤ºå½¢çŠ¶å¯¹æ¯” - æ”¹è¿›ç‰ˆæœ¬ï¼Œç§»é™¤è¿”å›æŒ‰é’®
         */
        function displayShapeComparison(sourceShape, targetShape) {
            const title = document.getElementById('shape-title');
            const propertiesList = document.getElementById('properties-list');
            
            // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºå˜æ¢å…³ç³»
            title.innerHTML = `
                <span style="color: #FF6B6B;">${shapes[sourceShape].title}</span> 
                <span style="color: #666; font-size: 0.8em;">â†’</span> 
                <span style="color: #4CAF50;">${shapes[targetShape].title}</span>
            `;
            
            clearVisualHighlights();
            
            // åˆ›å»ºå¯¹æ¯”å†…å®¹
            propertiesList.innerHTML = '';
            
            // æŒ‰ç±»åˆ«ç»„ç»‡æ¯”è¾ƒ
            const categories = ['sides', 'angles', 'parallel', 'diagonals'];
            
            categories.forEach((category, categoryIndex) => {
                const categoryInfo = propertyCategories[category];
                if (!categoryInfo) return;
                
                const sourceProp = getShapePropertyInCategory(sourceShape, category);
                const targetProp = getShapePropertyInCategory(targetShape, category);
                
                // å¦‚æœè¯¥ç±»åˆ«ä¸‹ä¸¤ä¸ªå½¢çŠ¶éƒ½æ²¡æœ‰ç‰¹æ€§ï¼Œåˆ™è·³è¿‡
                if (!sourceProp && !targetProp) return;
                
                // è·å–å…³ç³»ä¿¡æ¯
                const relationshipInfo = getRelationshipInfo(sourceProp, targetProp, category);
                
                setTimeout(() => {
                    // åˆ›å»ºåˆå¹¶çš„ç±»åˆ«æ¯”è¾ƒå—
                    const comparisonResult = comparePropertyLevels(sourceProp, targetProp);
                    
                    const categoryBlock = document.createElement('div');
                    categoryBlock.className = `property-comparison category-${category}`;
                    categoryBlock.style.cssText = `
                        margin: 15px 0;
                        background: linear-gradient(135deg, #f8f9ff 0%, #e8f5e8 100%);
                        border-radius: 12px;
                        border-left: 4px solid ${comparisonResult.color};
                        box-shadow: 0 3px 6px rgba(0,0,0,0.08);
                        transition: all 0.3s ease;
                        opacity: 0;
                        transform: translateY(20px);
                        animation: slideInCategory 0.6s ease forwards;
                        animation-delay: ${categoryIndex * 0.2}s;
                        overflow: hidden;
                    `;
                    
                    // åˆ›å»ºæ¯”è¾ƒå†…å®¹
                    const sourceContent = sourceProp ? `
                        <div style="display: flex; align-items: center;">
                            <div>
                                <div style="font-size: 13px; font-weight: bold; color: #333;">${sourceProp.text}</div>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">
                                    ${getPropertyLevelInfo(category, sourceProp.level)?.description || ''}
                                </div>
                            </div>
                        </div>
                    ` : `
                        <div style="color: #999; font-size: 13px; text-align: center;">
                            <div>âŒ ç„¡æ­¤ç‰¹æ€§</div>
                        </div>
                    `;
                    
                    const targetContent = targetProp ? `
                        <div style="display: flex; align-items: center;">
                            <div>
                                <div style="font-size: 13px; font-weight: bold; color: #333;">${targetProp.text}</div>
                                <div style="font-size: 11px; color: #666; margin-top: 2px;">
                                    ${getPropertyLevelInfo(category, targetProp.level)?.description || ''}
                                </div>
                            </div>
                        </div>
                    ` : `
                        <div style="color: #999; font-size: 13px; text-align: center;">
                            <div>âŒ ç„¡æ­¤ç‰¹æ€§</div>
                        </div>
                    `;
                    
                    categoryBlock.innerHTML = `
                        <!-- ç±»åˆ«æ ‡é¢˜åŒºåŸŸ -->
                        <div style="padding: 12px 15px 8px 15px; border-bottom: 1px solid rgba(255,255,255,0.5);">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-weight: bold; font-size: 15px; color: #333;">${categoryInfo.name}</span>
                                ${relationshipInfo ? `<span style="font-size: 12px; color: #666; font-weight: normal;">${relationshipInfo}</span>` : ''}
                            </div>
                        </div>
                        
                        <!-- æ¯”è¾ƒå†…å®¹åŒºåŸŸ -->
                        <div style="display: flex; align-items: center; padding: 15px;">
                            <div style="flex: 1; padding-right: 15px;">
                                ${sourceContent}
                            </div>
                            <div style="flex: 0 0 80px; text-align: center;">
                                <div style="background: transparent; color: ${comparisonResult.color}; border: none; border-radius: 20px; padding: 8px 12px; font-size: 16px; box-shadow: none;">
                                    ${comparisonResult.icon}
                                </div>
                                <div style="font-size: 10px; color: ${comparisonResult.color}; margin-top: 4px; font-weight: bold;">
                                    ${comparisonResult.description}
                                </div>
                            </div>
                            <div style="flex: 1; padding-left: 15px;">
                                ${targetContent}
                            </div>
                        </div>
                    `;
                    
                    // æ·»åŠ ç‚¹å‡»é«˜äº®åŠŸèƒ½
                    categoryBlock.addEventListener('click', () => {
                        document.querySelectorAll('.property-comparison').forEach(block => {
                            block.style.boxShadow = '0 3px 6px rgba(0,0,0,0.08)';
                            block.style.transform = 'scale(1)';
                        });
                        
                        categoryBlock.style.boxShadow = '0 6px 12px rgba(0,0,0,0.15)';
                        categoryBlock.style.transform = 'scale(1.02)';
                        
                        // é«˜äº®å¯¹åº”çš„è§†è§‰å…ƒç´ 
                        if (targetProp && targetProp.visual) {
                            highlightVisualElement(targetProp.visual);
                        }
                    });
                    
                    propertiesList.appendChild(categoryBlock);
                    
                }, categoryIndex * 300);
            });
        }

        /**
         * åŠ¨ç”»å˜æ¢å‡½æ•° - åŠ¨ç”»å®Œæˆåæ˜¾ç¤ºæ§åˆ¶æŒ‰é’®
         */
        function animateTransformation(sourceShape, targetShape) {
            if (isAnimating) return;
            
            isAnimating = true;
            animationState.isActive = true;
            
            const polygon = document.getElementById('main-shape');
            const progressBar = document.querySelector('.progress-bar');
            const animationControls = document.querySelector('.animation-controls');
            const progressContainer = document.querySelector('.transformation-progress');
            const animateBtn = document.getElementById('animate-transformation-btn');
            const comparisonBtn = document.getElementById('comparison-btn');
            
            // éšè—æ§åˆ¶æŒ‰é’®ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡
            animationControls.style.display = 'none';
            progressContainer.style.display = 'block';
            
            // è·å–èµ·å§‹å’Œç›®æ ‡ç‚¹
            const sourcePoints = shapes[sourceShape].points.split(' ').map(p => {
                const [x, y] = p.split(',').map(Number);
                return { x, y };
            });
            
            const targetPoints = shapes[targetShape].points.split(' ').map(p => {
                const [x, y] = p.split(',').map(Number);
                return { x, y };
            });
            
            // è®¾ç½®èµ·å§‹å½¢çŠ¶
            polygon.setAttribute('points', shapes[sourceShape].points);
            updateVisualMarkers(sourceShape);
            
            // åŠ¨ç”»å‚æ•°
            const duration = 3000; // 3ç§’åŠ¨ç”»
            const steps = 60; // 60å¸§
            const stepDuration = duration / steps;
            let currentStep = 0;
            
            // æ·»åŠ å˜æ¢åŠ¨ç”»ç±»
            polygon.classList.add('transforming');
            
            const animationInterval = setInterval(() => {
                const progress = currentStep / steps;
                
                // æ›´æ–°è¿›åº¦æ¡
                progressBar.style.width = `${progress * 100}%`;
                
                // è®¡ç®—å½“å‰å¸§çš„ç‚¹åæ ‡ï¼ˆçº¿æ€§æ’å€¼ï¼‰
                const currentPoints = sourcePoints.map((point, index) => {
                    const targetPoint = targetPoints[index];
                    const x = point.x + (targetPoint.x - point.x) * progress;
                    const y = point.y + (targetPoint.y - point.y) * progress;
                    return `${x},${y}`;
                }).join(' ');
                
                polygon.setAttribute('points', currentPoints);
                
                // æ›´æ–°è§†è§‰æ ‡è®°ï¼ˆåœ¨ä¸­é—´é˜¶æ®µé€æ¸è¿‡æ¸¡ï¼‰
                if (progress < 0.3) {
                    updateVisualMarkers(sourceShape);
                } else if (progress > 0.7) {
                    updateVisualMarkers(targetShape);
                } else {
                    updateVisualMarkers(sourceShape);
                }
                
                currentStep++;
                
                if (currentStep > steps) {
                    clearInterval(animationInterval);
                    
                    // åŠ¨ç”»å®Œæˆ
                    polygon.setAttribute('points', shapes[targetShape].points);
                    polygon.classList.remove('transforming');
                    polygon.classList.add('animating');
                    
                    // æ›´æ–°åˆ°ç›®æ ‡å½¢çŠ¶
                    updateVisualMarkers(targetShape);
                    
                    // åªæ˜¾ç¤ºç›®æ ‡å½¢çŠ¶ï¼Œä¸è‡ªåŠ¨åˆ‡æ¢åˆ°å¯¹æ¯”æ¨¡å¼
                    displayShape(targetShape);
                    updateActiveShape(targetShape);
                    
                    // æ¢å¤æ§åˆ¶æŒ‰é’®çŠ¶æ€ï¼Œå¹¶è®¾ç½®æŒ‰é’®åŠŸèƒ½
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        progressBar.style.width = '0%';
                        
                        // è®¾ç½®æŒ‰é’®æ–‡å­—å’ŒåŠŸèƒ½
                        animateBtn.textContent = 'ğŸ”„ å†æ¬¡æ’­æ”¾';
                        animateBtn.onclick = () => {
                            animateTransformation(sourceShape, targetShape);
                        };
                        
                        comparisonBtn.textContent = 'ğŸ“Š é¡¯ç¤ºç‰¹æ€§å°æ¯”';
                        comparisonBtn.onclick = () => {
                            toggleComparison(sourceShape, targetShape);
                        };
                        
                        // æ˜¾ç¤ºæ§åˆ¶æŒ‰é’®
                        animationControls.style.display = 'flex';
                        
                        polygon.classList.remove('animating');
                        isAnimating = false;
                        animationState.isActive = false;
                    }, 500);
                }
            }, stepDuration);
        }

        /**
         * è·å–å˜æ¢æè¿°
         */
        function getTransformationDescription(sourceShape, targetShape) {
            const transformKey = `${sourceShape}-${targetShape}`;
            return transformationPaths[transformKey] || 'ç„¡æ³•ç›´æ¥è®Šæ›ï¼Œè«‹é¸æ“‡å…¶ä»–è·¯å¾‘';
        }

        /**
         * æ›´æ–°æ´»åŠ¨å½¢çŠ¶
         */
        function updateActiveShape(shapeName) {
            document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
            const btn = document.querySelector(`[data-shape="${shapeName}"]`);
            if (btn) btn.classList.add('active');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å½¢çŠ¶æŒ‰é’®äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.shape-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    handleShapeSelection(btn.dataset.shape);
                });
            });

            // å…³ç³»å›¾æŒ‰é’®äº‹ä»¶ç›‘å¬
            document.getElementById('relationship-diagram-btn').addEventListener('click', () => {
                if (isRelationshipDiagramMode) {
                    // å½“å‰åœ¨å…³ç³»å›¾æ¨¡å¼ï¼Œåˆ‡æ¢å›å½¢çŠ¶æ˜¾ç¤º
                    hideRelationshipDiagram();
                    // æ˜¾ç¤ºå½“å‰é€‰ä¸­çš„å½¢çŠ¶
                    handleShapeSelection(currentShape);
                } else {
                    // å½“å‰åœ¨å½¢çŠ¶æ˜¾ç¤ºæ¨¡å¼ï¼Œåˆ‡æ¢åˆ°å…³ç³»å›¾
                    showRelationshipDiagram();
                }
            });

            // å…³ç³»å›¾ä¸­å›¾å½¢åŒºåŸŸçš„ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('#relationship-svg rect[data-shape]').forEach(rect => {
                rect.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const shapeName = rect.getAttribute('data-shape');
                    if (shapeName && shapes[shapeName]) {
                        // åˆ‡æ¢åˆ°å¯¹åº”çš„å½¢çŠ¶æ˜¾ç¤º
                        hideRelationshipDiagram();
                        handleShapeSelection(shapeName);
                    }
                });
            });

            // å…³ç³»å›¾ä¸­å¯ç‚¹å‡»æ–‡æœ¬çš„äº‹ä»¶
            document.querySelectorAll('#relationship-svg text[style*="cursor: pointer"]').forEach(text => {
                text.addEventListener('click', (e) => {
                    e.stopPropagation();
                    // æ ¹æ®æ–‡æœ¬å†…å®¹åˆ¤æ–­å¯¹åº”çš„å½¢çŠ¶
                    const textContent = text.textContent;
                    if (textContent.includes('æ¢¯å½¢')) {
                        hideRelationshipDiagram();
                        handleShapeSelection('trapezoid');
                    } else if (textContent.includes('é•·æ–¹å½¢')) {
                        hideRelationshipDiagram();
                        handleShapeSelection('rectangle');
                    } else if (textContent.includes('è±å½¢')) {
                        hideRelationshipDiagram();
                        handleShapeSelection('rhombus');
                    } else if (textContent.includes('æ­£æ–¹å½¢')) {
                        hideRelationshipDiagram();
                        handleShapeSelection('square');
                    } else if (textContent.includes('å¹³è¡Œå››é‚Šå½¢')) {
                        hideRelationshipDiagram();
                        handleShapeSelection('parallelogram');
                    }
                });
            });

            // ç‚¹å‡»ç©ºç™½å¤„é‡ç½®é€‰æ‹©çŠ¶æ€
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.shape-node') && 
                    !e.target.closest('.relationship-info') &&
                    !e.target.closest('.property') &&
                    !e.target.closest('.property-comparison') &&
                    !e.target.closest('.animation-controls') &&
                    !e.target.closest('.transformation-progress')) {
                    
                    // é‡ç½®å˜æ¢åŒºåŸŸçŠ¶æ€
                    resetTransformationState();
                    
                    document.querySelectorAll('.property').forEach(p => {
                        p.classList.remove('highlight');
                    });
                    
                    document.querySelectorAll('.property-comparison').forEach(row => {
                        row.style.boxShadow = '0 3px 6px rgba(0,0,0,0.08)';
                        row.style.transform = 'scale(1)';
                    });
                    
                    clearVisualHighlights();
                }
            });

            // åˆå§‹åŒ–æ˜¾ç¤º
            displayShape('square');
            updateActiveShape('square');
        });
    </script>
</body>
</html>